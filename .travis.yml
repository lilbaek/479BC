language: c

jobs:
  include:
  - os: linux
    compiler: gcc
    env: SDL_LIB=SDL2-2.0.12 SDL_MIXER_LIB=SDL2_mixer-2.0.4 RUN_CODECOV=1
  - os: linux
    compiler: gcc
    env: SDL_LIB=SDL2-2.0.0 SDL_MIXER_LIB=SDL2_mixer-2.0.0
  - os: linux
    compiler: clang
    env: SDL_LIB=SDL2-2.0.12 SDL_MIXER_LIB=SDL2_mixer-2.0.4
  - os: linux
    compiler: gcc
    env: SDL_LIB=SDL2-2.0.12 SDL_MIXER_LIB=SDL2_mixer-2.0.4 BUILD_TARGET=linux DEPLOY=linux
  - os: linux
    dist: xenial # Oldest still-supported LTS right now against which the AppImage is built. Update this to the next LTS when support drops.
    name: Linux AppImage
    compiler: gcc
    env: BUILD_TARGET=appimage DEPLOY=appimage
  - os: osx
    compiler: clang
    env: SDL_LIB=SDL2-2.0.12 SDL_MIXER_LIB=SDL2_mixer-2.0.4 BUILD_TARGET=mac DEPLOY=mac

cache:
  directories:
  - $SDL_LIB
  - $SDL_MIXER_LIB

install:
  - ./.ci_scripts/setup_environment.sh
  - ./.ci_scripts/install_sdl.sh;

before_script:
  - ./.ci_scripts/run_cmake.sh

script:
  - ./.ci_scripts/run_build.sh

after_success:
  - if [ $RUN_CODECOV ];
    then
      bash <(curl -s https://codecov.io/bash);
    fi;
  - ./.ci_scripts/create_zipped_release.sh

before_deploy:
  - ./.ci_scripts/bintray_conf.sh

deploy:
  provider: bintray
  on:
    all_branches: true
    repo: Keriew/augustus
    condition: "$DEPLOY"
  file: bintray.json
  user: keriew
  skip_cleanup: true
  key: 03aa55a4d750d9f9eeff2ab29c759bdd4673f2fc
after_deploy:
- "./.ci_scripts/bintray_link.sh"
